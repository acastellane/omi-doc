<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>OC-Accel Registers - OMI Doc</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../extra.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">OMI Doc</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../.." class="dropdown-item">Overview</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Main Elements <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../blocs/fire.md" class="dropdown-item">(0) FIRE Description</a>
</li>
                                    
<li>
    <a href="../../blocs/apollo.md" class="dropdown-item">(1) APOLLO Description</a>
</li>
                                    
<li>
    <a href="../../blocs/ice.md" class="dropdown-item">(2) ICE Description</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../misc/doc-guide/" class="dropdown-item">Document Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/OpenCAPI/omi-doc" class="nav-link"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#oc-accel-registers" class="nav-link">OC-Accel Registers</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#memory-map" class="nav-link">Memory map</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#address-layout" class="nav-link">Address Layout</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#global-registers-summary" class="nav-link">Global Registers: Summary</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#global-registers-details" class="nav-link">Global Registers: Details</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#snap-basic-registers" class="nav-link">SNAP Basic Registers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#snap-debug-registers" class="nav-link">SNAP Debug Registers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#snap-fir-registers" class="nav-link">SNAP FIR Registers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#action-registers-summary" class="nav-link">Action Registers: Summary</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#hdl-design" class="nav-link">HDL design</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#hls-design" class="nav-link">HLS design</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#acronyms" class="nav-link">Acronyms</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="oc-accel-registers">OC-Accel Registers</h1>
<p>Configuration Registers link the software and hardware together. User application software code can use the provided <code>libosnap</code> APIs to read and write the registers implemented in FPGA logic, thus configure and control the functions in hardware. Those registers are also called MMIO (memory mapped IO) registers, because they are mapped into a large memory map. The "addresses" of these registers are 64bits wide.</p>
<h2 id="memory-map">Memory map</h2>
<p>The OpenCAPI3.0 device memory map concepts (BAR, MMIO Global, MMIO Per PASID, and also memory space) are specified with respect to <strong>OpenCAPI configuration space specification</strong>. Here is a conceptual memory map:</p>
<p><img alt="general-map" src="../pictures/reg-general-map.svg" /></p>
<p>For OC-Accel: </p>
<ul>
<li>It only supports 1 AFU</li>
<li>It only supports OpenCAPI3.0 C1 mode. MEM_SIZE = 0</li>
<li>It supports 512 PASIDs (User Process ID associated with a request)</li>
<li>It only uses BAR0</li>
<li>Global MMIO Offset = 0, Size = 2GB</li>
<li>Per PASID MMIO Offset = 2GB, Stride Size = 4MB</li>
</ul>
<p>So the above memory map is specified to:</p>
<p><img alt="oc-mmio" src="../pictures/reg-oc-mmio.svg" /></p>
<p>The settings can be found in:</p>
<pre><code>hardware/oc-bip/config_subsystem/cfg_descriptor.v
</code></pre>

<h2 id="address-layout">Address Layout</h2>
<p>OC-Accel registers have two categories: </p>
<ul>
<li><strong>Global Registers</strong>, 8B, defined in Global MMIO space. Use <code>snap_global_read/write64()</code> to access them. They are 64 bits wide since directly extracted from oc_cfg block.</li>
<li><strong>Action Registers</strong>, 4B, defined in Per PASID MMIO space. Use <code>snap_action_read/write32()</code> to access them. They are 32 bits wide since converted into AXI-lite protocol.</li>
</ul>
<p>The higher 32bits of tlx_afu_cmd_pa (Physical Address) should be matched with BAR0. </p>
<p>The lower 32bits, also called mmio_address, is processed in OC-Accel. </p>
<p><img alt="mmio-address" src="../pictures/reg-mmio-address.svg" /></p>
<p>User can use <code>snap_peek</code> (<code>snap_poke</code>) to read (write) these registers:</p>
<ul>
<li>Read OC global BDR register (Build date register):</li>
</ul>
<pre><code> $ snap_peek 0x0008
 [00000008]  0000202011181128
</code></pre>

<ul>
<li>Read OC action ATR register (Action ID):</li>
</ul>
<pre><code> $ snap_peek -w32 0x0010
 [00000010] 10143009
</code></pre>

<h1 id="global-registers-summary">Global Registers: Summary</h1>
<table>
<thead>
<tr>
<th>mmio_address[30:8]</th>
<th>mmio_address [7:0]</th>
<th>Abbr.</th>
<th>Register Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0  (Basic)</td>
<td>0x00</td>
<td>IVR</td>
<td>Implementation Version Register</td>
</tr>
<tr>
<td></td>
<td>0x08</td>
<td>BDR</td>
<td>Build Date Register</td>
</tr>
<tr>
<td></td>
<td>0x10</td>
<td>SCR</td>
<td>SNAP Command Register</td>
</tr>
<tr>
<td></td>
<td>0x18</td>
<td>SSR</td>
<td>SNAP Status Register</td>
</tr>
<tr>
<td></td>
<td>0x30</td>
<td>CAP</td>
<td>Capacity Register</td>
</tr>
<tr>
<td></td>
<td>0x40</td>
<td>FRT</td>
<td>Free Running Timer (Up Time Counter) Register</td>
</tr>
<tr>
<td></td>
<td>0x50</td>
<td>USR</td>
<td>User Defined Code Register</td>
</tr>
<tr>
<td></td>
<td>0x60</td>
<td>PRC</td>
<td>Partial Reconfiguration Code</td>
</tr>
<tr>
<td>0x1A0 (Debug)</td>
<td>0x00</td>
<td>DBG_CLR</td>
<td>Clear Debug Register</td>
</tr>
<tr>
<td></td>
<td>0x08</td>
<td>CNT_TLX_CMD</td>
<td>Number of TLX Commands</td>
</tr>
<tr>
<td></td>
<td>0x10</td>
<td>CNT_TLX_RSP</td>
<td>Number of TLX Responses</td>
</tr>
<tr>
<td></td>
<td>0x18</td>
<td>CNT_TLX_RTY</td>
<td>Number of TLX Retry Responses</td>
</tr>
<tr>
<td></td>
<td>0x20</td>
<td>CNT_TLX_FAIL</td>
<td>Number of TLX Fail Responses</td>
</tr>
<tr>
<td></td>
<td>0x28</td>
<td>CNT_TLX_XLP</td>
<td>Number of TLX Translate Pending Responses</td>
</tr>
<tr>
<td></td>
<td>0x30</td>
<td>CNT_TLX_XLD</td>
<td>Number of TLX Translate Done Responses</td>
</tr>
<tr>
<td></td>
<td>0x38</td>
<td>CNT_TLX_XLR</td>
<td>Number of TLX Translate Retry Responses</td>
</tr>
<tr>
<td></td>
<td>0x40</td>
<td>CNT_AXI_CMD</td>
<td>Number of total AXI Commands</td>
</tr>
<tr>
<td></td>
<td>0x48</td>
<td>CNT_AXI_RSP</td>
<td>Number of total AXI Responses</td>
</tr>
<tr>
<td></td>
<td>0x50</td>
<td>BUF_CNT</td>
<td>Counts in data buffers</td>
</tr>
<tr>
<td></td>
<td>0x58</td>
<td>TRAFIIC_IDLE</td>
<td>No traffic over a period</td>
</tr>
<tr>
<td></td>
<td>0x60</td>
<td>TLX_IDLE_LIM</td>
<td>Length of the period for TLX "no traffic"</td>
</tr>
<tr>
<td></td>
<td>0x68</td>
<td>AXI_IDLE_LIM</td>
<td>Length of the period for AXI "no traffic"</td>
</tr>
<tr>
<td>0x1C0 (FIR)</td>
<td>0x00</td>
<td>FIFO_OVFL</td>
<td>FIFO Overflow Status</td>
</tr>
<tr>
<td></td>
<td>0x08</td>
<td>FIR_TLX</td>
<td>Errors on TLX interface</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>FIR means "Fault Isolation Register". It usually means some errors happened.</p>
</div>
<h1 id="global-registers-details">Global Registers: Details</h1>
<h2 id="snap-basic-registers">SNAP Basic Registers</h2>
<h3 id="implementation-version-register-ivr">Implementation Version Register (IVR)</h3>
<ul>
<li>Offset: 0x00</li>
<li>POR value depends on source for the build. Example for build based on commit with SHA ID eb43f4d80334d6a127af150345fed12dc5f45b7c and with distance 13 to SNAP Release v1.25.4: 0x0119040D_EB43F4D8</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th></th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..40</td>
<td></td>
<td>RO</td>
<td>SNAP Release</td>
</tr>
<tr>
<td></td>
<td>63..56</td>
<td>RO</td>
<td>Major release number</td>
</tr>
<tr>
<td></td>
<td>55..48</td>
<td>RO</td>
<td>Intermediate release number</td>
</tr>
<tr>
<td></td>
<td>47..40</td>
<td>RO</td>
<td>Minor release number</td>
</tr>
<tr>
<td>39..32</td>
<td></td>
<td>RO</td>
<td>Distance of commit to SNAP release</td>
</tr>
<tr>
<td>31..0</td>
<td></td>
<td>RO</td>
<td>First eight digits of SHA ID for commit</td>
</tr>
</tbody>
</table>
<h3 id="build-date-register-bdr">Build Date Register (BDR)</h3>
<ul>
<li>Offset: 0x08</li>
<li>POR value depends on build date and time. Example for build on January 12th, 2017 at 15:27: 0x00002017_01121527</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..48</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>47.. 0</td>
<td>RO</td>
<td>BCD coded build date and time</td>
</tr>
<tr>
<td>47..32</td>
<td>RO</td>
<td>YYYY (year)</td>
</tr>
<tr>
<td>31..24</td>
<td>RO</td>
<td>mm   (month)</td>
</tr>
<tr>
<td>23..16</td>
<td>RO</td>
<td>dd   (day of month)</td>
</tr>
<tr>
<td>15..08</td>
<td>RO</td>
<td>HH   (hour)</td>
</tr>
<tr>
<td>07..00</td>
<td>RO</td>
<td>MM   (minute)</td>
</tr>
</tbody>
</table>
<h3 id="snap-command-register-scr">SNAP Command Register (SCR)</h3>
<ul>
<li>Offset: 0x10</li>
<li>Send SNAP commands via this register </li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..1</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>0</td>
<td>WO</td>
<td>soft reset to odma and action_wrapper</td>
</tr>
</tbody>
</table>
<h3 id="snap-status-register-ssr">SNAP Status Register (SSR)</h3>
<ul>
<li>Offset: 0x18</li>
<li>Status of snap_core</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..4</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>3</td>
<td>RO</td>
<td>SNAP fatal error: some bits are asserted in FIR registers</td>
</tr>
<tr>
<td>2</td>
<td>RO</td>
<td>SNAP AXI side busy (?)</td>
</tr>
<tr>
<td>1</td>
<td>RO</td>
<td>SNAP TLX side busy (?)</td>
</tr>
<tr>
<td>0</td>
<td>RO</td>
<td>SNAP idle: Data buffers in snap_core are empty</td>
</tr>
</tbody>
</table>
<h3 id="snap-capability-register-cap">SNAP Capability Register (CAP)</h3>
<ul>
<li>Offset: 0x30</li>
<li>Define the capability of the card</li>
</ul>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..32</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>31..16</td>
<td>RO</td>
<td>Size of attached on-card SDRAM in MB</td>
</tr>
<tr>
<td>15..8</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>7..0</td>
<td>RO</td>
<td>Card type:</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x31 : AD9V3</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x32 : AD9H3</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x33 : AD9H7</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x34 : BW250SOC</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0x35 : AD9H335</td>
</tr>
</tbody>
</table>
<h3 id="snap-free-running-timer-frt">SNAP Free Running Timer  (FRT)</h3>
<ul>
<li>Offset: 0x40</li>
<li>is updated at each mmio clock</li>
</ul>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..0</td>
<td>RO</td>
<td>Counter value (mmio clock ticks since last reset)</td>
</tr>
</tbody>
</table>
<h3 id="snap-user-defined-code-register-usr">SNAP User Defined Code Register (USR)</h3>
<ul>
<li>Offset: 0x50</li>
<li>Allows user to write a 64 bits wide user defined code in this register to ease debugging versions without modifying  the release. (for the time being it is hand written in hardware/setup/patch-version.sh) Use <em>oc_maint -u</em> to read it in simulation or on actual hardware.</li>
</ul>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..0</td>
<td>RO</td>
<td>64 bits (can represent 8 ASCII char) user defined code</td>
</tr>
</tbody>
</table>
<h3 id="snap-partial-reconfiguration-code-prc">SNAP Partial Reconfiguration Code (PRC)</h3>
<ul>
<li>Offset: 0x60</li>
<li>Oc-accel stores a random code in this register to identify the static configuration and provides a mean to verify dynamic configurations against the static image.</li>
</ul>
<p>Bitwise definition</p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..0</td>
<td>RO</td>
<td>64 bits (can represent 8 ASCII char) Partial Reconfiguration Code</td>
</tr>
</tbody>
</table>
<h2 id="snap-debug-registers">SNAP Debug Registers</h2>
<ul>
<li>base_addr: 0x1A0</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Subject to change.</p>
</div>
<h3 id="debug-clear-and-debug-counters">Debug Clear and Debug Counters</h3>
<p>DBG_CLR: Clear all of the following debug registers
For following registers: bit[63:32] for Reads, bit [31:0] for Writes.</p>
<ul>
<li>CNT_TLX_CMD: Number of TLX Commands  </li>
<li>CNT_TLX_RSP: Number of TLX Responses  </li>
<li>CNT_TLX_RTY: Number of TLX Retry Responses  </li>
<li>CNT_TLX_FAIL: Number of TLX Fail Responses  </li>
<li>CNT_TLX_XLP: Number of TLX Translate Pending Responses  </li>
<li>CNT_TLX_XLD: Number of TLX Translate Done Responses  </li>
<li>CNT_TLX_XLR: Number of TLX Translate Retry Responses  </li>
<li>CNT_AXI_CMD: Number of total AXI Commands  </li>
<li>CNT_AXI_RSP: Number of total AXI Responses  </li>
<li>BUF_CNT: How many entries are valid for Read buffer and Write buffer</li>
</ul>
<h3 id="traffic-idle-status">Traffic Idle status</h3>
<p>TRAFFIC_IDLE: Used together with TLX_IDLE_LIM and AXI_IDLE_LIM. </p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..6</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>5</td>
<td>RO</td>
<td>tlx_cmd_idle in a certain number of cycles</td>
</tr>
<tr>
<td>4</td>
<td>RO</td>
<td>tlx_rsp_idle in a certain number of cycles</td>
</tr>
<tr>
<td>3</td>
<td>RO</td>
<td>axi_cmd_idle (Read) in a certain number of cycles</td>
</tr>
<tr>
<td>2</td>
<td>RO</td>
<td>axi_rsp_idle (Read) in a certain number of cycles</td>
</tr>
<tr>
<td>1</td>
<td>RO</td>
<td>axi_cmd_idle (Write) in a certain number of cycles</td>
</tr>
<tr>
<td>0</td>
<td>RO</td>
<td>axi_rsp_idle (Write) in a certain number of cycles</td>
</tr>
</tbody>
</table>
<h2 id="snap-fir-registers">SNAP FIR Registers</h2>
<ul>
<li>base_addr: 0x1C0</li>
</ul>
<h3 id="fifo-overflow-status-fifo_ovfl">FIFO Overflow Status (FIFO_OVFL)</h3>
<ul>
<li>offset: 0x00</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..6</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>7</td>
<td>RO</td>
<td>fir_fifo_overflow_cmdencw (Write Command Encoder)</td>
</tr>
<tr>
<td>6</td>
<td>RO</td>
<td>fir_fifo_overflow_cmdencr (Read Command Encoder)</td>
</tr>
<tr>
<td>5</td>
<td>RO</td>
<td>fir_fifo_overflow_cmdcnv (Command Clock Converter)</td>
</tr>
<tr>
<td>4</td>
<td>RO</td>
<td>fir_fifo_overflow_rspcnv (Response Clock Converter)</td>
</tr>
<tr>
<td>3</td>
<td>RO</td>
<td>fir_fifo_overflow_rspdecw (Write Response Decoder)</td>
</tr>
<tr>
<td>2</td>
<td>RO</td>
<td>fir_fifo_overflow_rspdecr (Read Response Decoder)</td>
</tr>
<tr>
<td>1</td>
<td>RO</td>
<td>fir_fifo_overflow_dbw (Write Data Buffer)</td>
</tr>
<tr>
<td>0</td>
<td>RO</td>
<td>fir_fifo_overflow_dbr (Read Data Buffer)</td>
</tr>
</tbody>
</table>
<h3 id="tlx-interface-errors-fir_tlx">TLX Interface errors (FIR_TLX)</h3>
<ul>
<li>offset: 0x08</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>63..3</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>3</td>
<td>RO</td>
<td>fir_tlx_response_unsupport</td>
</tr>
<tr>
<td>2</td>
<td>RO</td>
<td>fir_tlx_rsp_err</td>
</tr>
<tr>
<td>1:0</td>
<td>RO</td>
<td>fir_tlx_command_credit</td>
</tr>
</tbody>
</table>
<h1 id="action-registers-summary">Action Registers: Summary</h1>
<p>mmio_address[30:22] means PASID. That means, the first process opens the OC Device, it will attach PASID=0 when it calls <code>mmio_action_read/write32()</code>. Meanwhile, the second process, the third process may attach PASID=1 and PASID=2 when they access the OC Device. Each process has its own "process context", and when OC Device wants to visit the host memory, it has to know which "process context" it belongs to, that means, the OC device needs to send the PASID with its commands. This PASID takes AWUSER or ARUSER as the vehicle to transfer from Action wrapper to snap_core. </p>
<h2 id="hdl-design">HDL design</h2>
<p>The user can freely define and implement the Action registers if it is written in Verilog/VHDL. However, there are still a registers that are recommended to implement. They are: </p>
<table>
<thead>
<tr>
<th>mmio_address [21:0]</th>
<th>Abbr.</th>
<th>Register Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00</td>
<td>ACR</td>
<td>Action Control Register</td>
</tr>
<tr>
<td>0x04</td>
<td>IER</td>
<td>Interrupt Enable Register</td>
</tr>
<tr>
<td>0x10</td>
<td>ATR</td>
<td>Action Type Register</td>
</tr>
<tr>
<td>0x14</td>
<td>AVR</td>
<td>Action Version Register</td>
</tr>
<tr>
<td>0x18</td>
<td>ISL</td>
<td>Interrupt Handle SRC Address Low</td>
</tr>
<tr>
<td>0x1C</td>
<td>ISH</td>
<td>Interrupt Handle SRC Address High</td>
</tr>
<tr>
<td>0x30 -&gt; end</td>
<td></td>
<td>Reserved and can be freely used</td>
</tr>
</tbody>
</table>
<h3 id="action-control-register-acr">Action Control Register (ACR)</h3>
<ul>
<li>offset: 0x00</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..4</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>3</td>
<td>RO</td>
<td>Action Ready</td>
</tr>
<tr>
<td>2</td>
<td>RO</td>
<td>Action Idle</td>
</tr>
<tr>
<td>1</td>
<td>RO</td>
<td>Action Done</td>
</tr>
<tr>
<td>0</td>
<td>RW</td>
<td>Write 1 to start Action, Read it to know whether the action has been started</td>
</tr>
</tbody>
</table>
<h3 id="interrupt-enable-register-ier">Interrupt Enable Register (IER)</h3>
<ul>
<li>offset: 0x04</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..1</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>0</td>
<td>RW</td>
<td>Enable Interrupt</td>
</tr>
</tbody>
</table>
<h3 id="action-type-register-atr">Action Type Register (ATR)</h3>
<ul>
<li>offset: 0x10 </li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..0</td>
<td>RO</td>
<td>Action Type, i.e, 0x10141008</td>
</tr>
</tbody>
</table>
<h3 id="action-version-register-avr">Action Version Register (AVR)</h3>
<ul>
<li>offset: 0x14</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..0</td>
<td>RO</td>
<td>Action Release Version, user defined</td>
</tr>
</tbody>
</table>
<h3 id="interrupt-handle-src-address-low-isl">Interrupt Handle SRC Address Low (ISL)</h3>
<ul>
<li>offset: 0x18</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..0</td>
<td>RO</td>
<td>Interrupt Handle Source Address Low 32bits</td>
</tr>
</tbody>
</table>
<h3 id="interrupt-handle-src-address-high-ish">Interrupt Handle SRC Address High (ISH)</h3>
<ul>
<li>offset: 0x1C</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..0</td>
<td>RO</td>
<td>Interrupt Handle Source Address High 32bits</td>
</tr>
</tbody>
</table>
<h2 id="hls-design">HLS design</h2>
<p>OC-Accel has already defined the Action Register Layout for HLS Actions.  </p>
<table>
<thead>
<tr>
<th>mmio_address [21:0]</th>
<th>Abbr.</th>
<th>Register Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00</td>
<td>ACR</td>
<td>Action Control Register</td>
</tr>
<tr>
<td>0x04</td>
<td>IER</td>
<td>Global Interrupt Enable Register</td>
</tr>
<tr>
<td>0x08</td>
<td>IIE</td>
<td>IP Interrupt Enable</td>
</tr>
<tr>
<td>0x0C</td>
<td>IIS</td>
<td>IP Interrupt Status</td>
</tr>
<tr>
<td>0x10</td>
<td>ATR</td>
<td>Action Type Register</td>
</tr>
<tr>
<td>0x14</td>
<td>AVR</td>
<td>Action Release Register</td>
</tr>
<tr>
<td>0x18</td>
<td>ISL</td>
<td>Interrupt Handle SRC Address Low</td>
</tr>
<tr>
<td>0x1C</td>
<td>ISH</td>
<td>Interrupt Handle SRC Address High</td>
</tr>
<tr>
<td>0x20</td>
<td>ACTION_HBM_IF_NUM</td>
<td>HBM AXI Interface Number</td>
</tr>
<tr>
<td>0x100</td>
<td>CONTROL1</td>
<td>sat + flags + seq</td>
</tr>
<tr>
<td>0x104</td>
<td>CONTROL2</td>
<td>Return Code</td>
</tr>
<tr>
<td>0x108</td>
<td>CONTROL3</td>
<td>Reserved</td>
</tr>
<tr>
<td>0x10C</td>
<td>CONTROL4</td>
<td>Reserved</td>
</tr>
<tr>
<td>0x110 - 0x178</td>
<td></td>
<td>Job Data Registers (108 bytes)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>0x00 to 0x0C are defined by Xilinx Document UG902.</p>
</div>
<h3 id="action-control-register-acr_1">Action Control Register (ACR)</h3>
<ul>
<li>offset: 0x00</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..8</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>7</td>
<td>RW</td>
<td>Auto Restart</td>
</tr>
<tr>
<td>6..4</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>3</td>
<td>RO</td>
<td>Action Ready</td>
</tr>
<tr>
<td>2</td>
<td>RO</td>
<td>Action Idle</td>
</tr>
<tr>
<td>1</td>
<td>RO/Clear on Read</td>
<td>Action Done</td>
</tr>
<tr>
<td>0</td>
<td>RW/Clear on Read</td>
<td>Start Action</td>
</tr>
</tbody>
</table>
<h3 id="global-interrupt-enable-ier">Global Interrupt Enable (IER)</h3>
<ul>
<li>offset: 0x04</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..1</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>0</td>
<td>RW</td>
<td>Enable Interrupt</td>
</tr>
</tbody>
</table>
<h3 id="ip-interrupt-enable-iie">IP Interrupt Enable (IIE)</h3>
<ul>
<li>offset: 0x08</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..2</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>1</td>
<td>RW</td>
<td>Interrupt for ap_ready is enabled</td>
</tr>
<tr>
<td>0</td>
<td>RW</td>
<td>Interrupt for ap_done is enabled</td>
</tr>
</tbody>
</table>
<h3 id="ip-interrupt-status-iis">IP Interrupt Status (IIS)</h3>
<ul>
<li>offset: 0x0C</li>
</ul>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Attributes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>31..2</td>
<td>RO</td>
<td>Reserved</td>
</tr>
<tr>
<td>1</td>
<td>RW</td>
<td>Status for ap_ready interrupt</td>
</tr>
<tr>
<td>0</td>
<td>RW</td>
<td>Status for ap_done interrupt</td>
</tr>
</tbody>
</table>
<h3 id="atr-avr-isl-ish">ATR, AVR, ISL, ISH</h3>
<p>These 4 registers have the same definitions as in HDL Action.</p>
<ul>
<li>offset: 0x10,  ATR, Action Type Register</li>
<li>offset: 0x14, AVR, Action Release Register</li>
<li>offset:  0x18, ISL, Interrupt Handle SRC Address Low </li>
<li>offset: 0x1C, ISH, Interrupt Handle SRC Address High </li>
</ul>
<h3 id="hls-control-registers">HLS CONTROL Registers</h3>
<p>4 registers are defined in <code>actions/include/hls_snap.H</code>. 
They take the addresses of 0x100, 0x104, 0x108 and 0x10C. </p>
<pre><code>typedef struct {
        snapu8_t sat; // short action type
        snapu8_t flags;
        snapu16_t seq;
        snapu32_t Retc;
        snapu64_t Reserved; // Priv_data
} CONTROL;
</code></pre>

<h3 id="hls-job-data-registers">HLS Job DATA Registers</h3>
<p>0x110 to 0x178 are user defined Job data structure. The size limit is 108 bytes. This is usually defined in <code>actions/hls_&lt;action_name&gt;/include/&lt;action_name&gt;.h</code> 
For example:</p>
<pre><code>typedef struct helloworld_job {
    struct snap_addr in;    /* input data */
    struct snap_addr out;   /* offset table */
} helloworld_job_t;
</code></pre>

<h2 id="acronyms">Acronyms</h2>
<ul>
<li>PASID : Process Address Space ID</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../extra.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
